<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<SSOConfiguration>
    <CertificateValidation pathValidation="false"/>
    <!-- entityId="api-manager" is a logical id (not a machine name). Ensure this logical id is the same in your IDP configuration too -->
    <ServiceProvider
            entityId="api-manager"
            useAppSessions="true"
            filteredUri="/sso/login"
            logoutUri="/sso/logout"
            logoutRedirectUri="/api/portal/v1.4/sso/login"
            keystore="conf/sso-prd.jks"
            keystorePassphrase="engie@2025"
            keyAlias="ssokey"
            sessionIdCookieName="spSessionId2"
            >
            <AssertionConsumerService binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" location="/sso/login/post"/>
            <SingleLogoutService binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" location="/sso/logout/post"/>
            <SingleLogoutService binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect" location="/redirect"/>
     </ServiceProvider>
    <IdentityProviders>
        <!-- Change references to keycloak.int.acme.com:8443 to the Fully Qualified Domain Name:port of your IDP provider. -->
        <!-- Change verifyAssertionExpiration to false if you do not want validity time/date checking done on SAML assertions -->
        <SamlIdentityProvider
                entityId="http://www.okta.com/exkfpjnh99HNAjFUZ0i7"
                format="urn:oasis:names:tc:SAML:2.0:nameid-format:entity"
                metadataUrl="./idpmanager.xml"
                userNameAttribute="urn:oid:2.5.4.42"
                verifyAssertionExpiration="false"
                sign="true">
            <Mappings>
<RenameMapping source="email" target="mail"/>
<RenameMapping source="firstName" target="userfullname"/>
<RenameMapping source="division" target="description"/>
<FilterMapping>

      <Filter>(division=BU11)</Filter>

      <OutputAttribute name="role">User</OutputAttribute>
      <OutputAttribute name="organization">API Development</OutputAttribute>
          </FilterMapping>
            </Mappings>
            <Features>
                <Feature key="saml-allow-http-connection" value="true"/>
                <Feature key="saml-verify-metadata-signature" value="false"/>
            </Features>
        </SamlIdentityProvider>
    </IdentityProviders>
</SSOConfiguration>
